<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Nutrition Counselor</title>
    <link id="stylesheet" href="/css/stat-styles.css" rel="stylesheet"/>
    <link id="dark-mode-stylesheet"href="/css/dark-mode.css" rel="stylesheet" disabled/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Lobster&display=swap" rel="stylesheet">
</head>
<body>
<nav>
    <a href="/">Home</a>
    <a href="/stat-form">Workout-Tracker</a>
    <a href="/stats">Stats</a>
    <a href="/unc-store">Store</a>
    <select name="toggle" class="toggle-button" id="toggle" onchange="toggleMode()">
        <option value="light">Light Mode</option>
        <option value="dark">Dark Mode</option>
    </select>
</nav>
<br/>
<header>Store</header>
<div class="shop-items">
    <% items.forEach(item => { %>
        <div class="shop-item">
            <h2><%= item.name %></h2>
            <img src="<%= item.image_url %>" alt="<%= item.name %>">
            <p><%= item.description %></p>
            <p>Category: <%= item.category %></p>
            <p>Price: $<%= (parseFloat(item.price) || 0).toFixed(2) %></p>
            <button class="buy-button" data-id="<%= item.item_id %>" data-name="<%= item.name %>">Buy!</button>
        </div>
    <% }); %>
</div>

<script>
    document.querySelectorAll('.buy-button').forEach(button => {
        button.addEventListener('click', async (event) => {
            const id = event.target.dataset.id;
            const name = event.target.dataset.name;

            try {
                const response = await fetch('/set_avatar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `id=${encodeURIComponent(id)}&name=${encodeURIComponent(name)}`
                });

                if (response.ok) {
                    console.log('Avatar updated successfully');
                    alert('Avatar updated successfully!');
                } else {
                    console.error('Error updating avatar:', response.statusText);
                    alert('Error updating avatar. Please try again.');
                }
            } catch (error) {
                console.error('Fetch error:', error);
                alert('An error occurred. Please try again.');
            }
        });
    });
</script>
<script>
    function toggleMode() {
        // ... (rest of the toggleMode function remains unchanged)
    }

    // On page load, check local storage for theme preference
    window.onload = function() {
        // ... (rest of the window.onload function remains unchanged)
    }
</script>
</body>
</html>